<body class="background-color-body">
    <div class="container main-container-color shadow-lg">
 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
        <!--<script defer src="/static/chat.js"></script>-->
        
        <style>
            #chat {
                margin: 0 auto;
                text-align: center;
            }
            #messages {
                height: 500px;
                overflow-y: scroll;
                margin-bottom: 10px;
            }
            .message-box {
                padding: 10px;
                border-radius: 10px;
                margin-bottom: 5px;
                max-width: 80%;
            }
            .message-received {
                background-color: #f1f1f1;
                text-align: left;
                margin-left: auto;
            }
            .message-sent {
                background-color: #d1e7dd;
                text-align: right;
                margin-right: auto;
            }
        </style>

        <div class="row p-3 flex-column flex-md-row">
            <div class="col rounded">
                <div class="row flex-column flex-md-row background-color-body rounded">
                    <div class="col">
                        <div class="mt-3" id="messages"></div>
                    </div>
                </div>

                <div class="row flex-column flex-md-row background-color-body rounded mt-3 p-3">
                    <div class="col-10 text-center">
                        <input class="form-control" id="messageInput" autocomplete="off" placeholder="Type your message..."/>
                    </div>
                    <div class="col-2 text-center">
                        <button id="sendbutton" class="btn button-custom-color bio-font" onclick="sendMessage()">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const socket = io.connect('http://' + document.domain + ':' + location.port);
            console.log('Connected to WebSocket');

            socket.on('message', function(msg) {
                console.log('Received message:', msg);
                const messages = document.getElementById('messages');
                const newMessage = document.createElement('div');
                newMessage.classList.add('message-box', 'message-received'); // Add the custom class for received messages
                newMessage.innerHTML = msg;
                messages.appendChild(newMessage);
                messages.scrollTop = messages.scrollHeight;
            });

            document.getElementById('messageInput').addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    sendMessage(socket);
                }
            });

            document.getElementById('sendbutton').addEventListener('click', function() {
                sendMessage(socket);
            });
        });

        function sendMessage(socket) {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value;
            if (message !== "") {
                console.log('Sending message:', message);
                addSentMessage(message); // Add sent message to the UI
                socket.emit('message', message); // Send message to the server
                messageInput.value = '';
            }
        }

        function addSentMessage(message) {
            const messages = document.getElementById('messages');
            const newMessage = document.createElement('div');
            newMessage.classList.add('message-box', 'message-sent'); // Add the custom class for sent messages
            newMessage.innerHTML = message;
            messages.appendChild(newMessage);
            messages.scrollTop = messages.scrollHeight;
        }
    </script>
</body>
