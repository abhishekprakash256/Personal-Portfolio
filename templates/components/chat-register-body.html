<body class="background-color-body">
    <div class="container main-container-color shadow-lg">

    {% set title = "Enter the name of two particpants" %}
    {% include 'reusable/card-heading.html' %}
    <style>
        .submit-success-message {
            color: #557C55;
            font-size: 20px;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .submit-error-message {
            color: #FA7070;
            font-size: 20px;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .button-custom-color {
            background-color: #19A7CE;
            border-color: #19A7CE;
            color: #ffffff;
        }

        .button-custom-color:hover {
            background-color: #0D87B0;
            border-color: #0D87B0;
            color: #fefefe;
        }

        #qrcode {
            margin-top: 20px;
        }

        .button-container {
            margin-top: 20px; /* Space between buttons */
        }



        .hash-url{
            margin-top: 10px;
            margin-bottom: 20px;
        }
    </style>
        
    <body>
    <div class="row p-3 main-container-color flex-column flex-md-row">

        <div class = "col" >

        <div class = "row background-color-body rounded">
            
        <div class = "col-2 "></div>

        <div class="col-8 text-center background-color-body rounded p-3">
            <form id="chatRegistrationForm">
                <div class="form-group">
                    <input class="form-control mb-3" id="name_1" name="name_1" autocomplete="off" placeholder="1st Person name .."/>
                    <input class="form-control mb-3" id="name_2" name="name_2" autocomplete="off" placeholder="2nd Person name .."/>
                    <button id="submit" class="btn button-custom-color bio-font" type="submit">Sign Up</button>
                    <button type="button" class="btn button-custom-color bio-font" id="clearButton" style="display: none;">Clear</button>
                </div>
            </form>
        </div>

        <div class="col-2"></div>
        </div>
        </div>
    </div>
    <div id = "hashcontainer" class="row p-3 flex-column flex-md-row " style="display: none;">
        <div class="col rounded">
            <div class="row background-color-body rounded text-center">
                <div class = "col"></div>
                <div class = "col">
                <div id="chatHashUrl" style="display: none;">
                    <div class ="hash-url arial-font font-color-class " id="chatHashUrlDisplay"></div>
                    <button type="button" id="copyButton" class="btn button-custom-color bio-font">Copy Chat Url</button>
                    
                </div>
                </div>

                <div class = "col"></div>
            </div>



        </div>
    </div>


    <div id = "qrcontainer" class="row p-3 flex-column flex-md-row " style="display: none;">
    <div class="col">
    <div class="row background-color-body rounded text-center">
        <div class = "col"></div>
    
        <div class="col">
           <div class = "qr-code" id="qrcode"></div>
           <h1>This is test</h1>

        </div>
        <div class = "col"></div>
    
    </div>
    </div>





    </div>



   <!-- Load QRCode library from CDN -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
   <script>
    document.getElementById("chatRegistrationForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent the default form submission behavior

        // Get the names from the form
        var name_1 = document.getElementById("name_1").value;
        var name_2 = document.getElementById("name_2").value;

        // Send the form data to the Flask backend using AJAX
        fetch('/chat_user_sign_up', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name_1: name_1, name_2: name_2 })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Display the generated chat URL
                const chatHashUrlDisplay = document.getElementById("chatHashUrlDisplay");
                const chatUrl = window.location.origin + "/chat/" + data.hash;
                chatHashUrlDisplay.textContent = chatUrl;

                // Display the hash URL and QR container
                document.getElementById("qrcontainer").style.display = "block";
                document.getElementById("chatHashUrl").style.display = "block";
                document.getElementById("hashcontainer").style.display = "block";
                

                // Generate the QR code for the chat URL
                generateQRCode(chatUrl);
            }
        })
        .catch(error => console.error('Error:', error));
    });

    const qrcodeElement = document.getElementById("qrcode");
    const qr = new QRCode(qrcodeElement, {
        width: 200,
        height: 200
    });

    // Function to generate QR code
    function generateQRCode(url) {
        qr.clear(); // Clear the previous QR code
        qr.makeCode(url); // Generate QR code for the chat URL
    }

    // Select the copy button
    const copyButton = document.getElementById("copyButton");

    // Add click event listener to the copy button
    copyButton.addEventListener("click", function() {
        // Select the chat URL text
        const chatUrlText = document.getElementById("chatHashUrlDisplay").textContent;

        // Create a temporary textarea element to copy the text
        const textarea = document.createElement("textarea");
        textarea.value = chatUrlText;
        document.body.appendChild(textarea);
        textarea.select();

        // Copy the text to the clipboard
        document.execCommand("copy");

        // Remove the temporary textarea
        document.body.removeChild(textarea);

        // Provide visual feedback that the URL has been copied
        copyButton.textContent = "Copied!";
        setTimeout(function() {
            copyButton.textContent = "Copy Chat Url";
        }, 2000); // Change back to "Copy Chat Url" after 2 seconds
    });
</script>

</div>
</body>
